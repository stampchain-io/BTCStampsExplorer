{
  "info": {
    "name": "BTC Stamps Explorer API - Version Header Testing",
    "description": "Comprehensive X-API-Version header testing for v2.2 (no market data) and v2.3 (enhanced market_data structure) API compatibility",
    "version": "2.3.1",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "test_address",
      "value": "bc1qzxszplp8v7w0jc89dlrqyct9staqlhwxzy7lkq",
      "type": "string"
    },
    {
      "key": "test_src20_tick",
      "value": "STAMP",
      "type": "string"
    },
    {
      "key": "version_validation_results",
      "value": "[]",
      "type": "any"
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Initialize version testing session",
          "if (!pm.collectionVariables.get('test_session_id')) {",
          "    pm.collectionVariables.set('test_session_id', Date.now().toString());",
          "    console.log('üîç Starting API Version Compatibility Testing');",
          "    console.log('  üìã Testing v2.2 (no market data) vs v2.3 (enhanced market_data structure)');",
          "    console.log('  üéØ Validating field transformations and schema compliance');",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Store version test results for reporting",
          "const endpoint = pm.request.url.getPath();",
          "const version = pm.request.headers.get('X-API-Version') || 'default';",
          "const testResult = {",
          "    endpoint: endpoint,",
          "    version: version,",
          "    timestamp: new Date().toISOString(),",
          "    status: pm.response.code,",
          "    hasMarketData: false,",
          "    hasRootPriceFields: false",
          "};",
          "",
          "if (pm.response.to.have.status(200)) {",
          "    try {",
          "        const json = pm.response.json();",
          "        if (json.data && Array.isArray(json.data) && json.data.length > 0) {",
          "            const firstItem = json.data[0];",
          "            testResult.hasMarketData = firstItem.hasOwnProperty('market_data');",
          "            testResult.hasRootPriceFields = firstItem.hasOwnProperty('floorPrice') || firstItem.hasOwnProperty('floorPriceUSD');",
          "        }",
          "    } catch (e) {",
          "        console.log('Error parsing response:', e);",
          "    }",
          "}",
          "",
          "// Store result for final reporting",
          "let results = pm.collectionVariables.get('version_validation_results') || '[]';",
          "try {",
          "    const resultArray = JSON.parse(results);",
          "    resultArray.push(testResult);",
          "    pm.collectionVariables.set('version_validation_results', JSON.stringify(resultArray));",
          "} catch (e) {",
          "    console.log('Error storing test result:', e);",
          "}"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "üîÑ v2.2 API Tests - Legacy Format (No Market Data)",
      "item": [
        {
          "name": "Stamps List - v2.2 (No Market Data)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ v2.2 - Stamps endpoint responds successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('‚ö° v2.2 - Response time acceptable', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(5000);",
                  "});",
                  "",
                  "pm.test('üìã v2.2 - Response has valid JSON structure', function () {",
                  "    pm.response.to.have.jsonBody();",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('data');",
                  "    pm.expect(json.data).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('üö´ v2.2 CRITICAL - No market_data field should exist', function () {",
                  "    const json = pm.response.json();",
                  "    if (json.data && Array.isArray(json.data) && json.data.length > 0) {",
                  "        const firstItem = json.data[0];",
                  "        pm.expect(firstItem).to.not.have.property('market_data', 'v2.2 should never include market_data field');",
                  "    }",
                  "});",
                  "",
                  "pm.test('üö´ v2.2 CRITICAL - No root-level price fields should exist', function () {",
                  "    const json = pm.response.json();",
                  "    if (json.data && Array.isArray(json.data) && json.data.length > 0) {",
                  "        const firstItem = json.data[0];",
                  "        pm.expect(firstItem).to.not.have.property('floorPrice', 'v2.2 should not have root floorPrice');",
                  "        pm.expect(firstItem).to.not.have.property('floorPriceUSD', 'v2.2 should not have root floorPriceUSD');",
                  "        pm.expect(firstItem).to.not.have.property('marketCapUSD', 'v2.2 should not have root marketCapUSD');",
                  "    }",
                  "});",
                  "",
                  "pm.test('‚úÖ v2.2 - Core stamp fields are present', function () {",
                  "    const json = pm.response.json();",
                  "    if (json.data && Array.isArray(json.data) && json.data.length > 0) {",
                  "        const firstItem = json.data[0];",
                  "        pm.expect(firstItem).to.have.property('stamp');",
                  "        pm.expect(firstItem).to.have.property('cpid');",
                  "        // stamp_url is v2.3 only, should NOT be in v2.2",
                  "        pm.expect(firstItem).to.not.have.property('stamp_url', 'v2.2 should not include stamp_url');",
                  "    }",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-API-Version",
                "value": "2.2",
                "description": "Request v2.2 format (no market data)"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v2/stamps?limit=5",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v2", "stamps"],
              "query": [
                {
                  "key": "limit",
                  "value": "5"
                }
              ]
            }
          }
        },
        {
          "name": "SRC20 Balance List - v2.2 (No Market Data)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ v2.2 - SRC20 Balance endpoint responds', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('‚ö° v2.2 - Response time acceptable', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(5000);",
                  "});",
                  "",
                  "pm.test('üìã v2.2 - Response has valid JSON structure', function () {",
                  "    pm.response.to.have.jsonBody();",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('data');",
                  "});",
                  "",
                  "pm.test('üö´ v2.2 CRITICAL - No market_data field should exist', function () {",
                  "    const json = pm.response.json();",
                  "    if (json.data && Array.isArray(json.data) && json.data.length > 0) {",
                  "        const firstItem = json.data[0];",
                  "        pm.expect(firstItem).to.not.have.property('market_data', 'v2.2 should never include market_data field');",
                  "    }",
                  "});",
                  "",
                  "pm.test('üö´ v2.2 - Should not have v2.3 enhanced fields', function () {",
                  "    const json = pm.response.json();",
                  "    if (json.data && Array.isArray(json.data) && json.data.length > 0) {",
                  "        const firstItem = json.data[0];",
                  "        pm.expect(firstItem).to.not.have.property('dispenserInfo');",
                  "        pm.expect(firstItem).to.not.have.property('cacheStatus');",
                  "        pm.expect(firstItem).to.not.have.property('dataQualityScore');",
                  "    }",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-API-Version",
                "value": "2.2",
                "description": "Request v2.2 format (no market data)"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v2/src20/balance/{{test_address}}?limit=5",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v2", "src20", "balance", "{{test_address}}"],
              "query": [
                {
                  "key": "limit",
                  "value": "5"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "üöÄ v2.3 API Tests - Enhanced Format (With MarketData)",
      "item": [
        {
          "name": "Stamps List - v2.3 (Enhanced MarketData)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ v2.3 - Stamps endpoint responds successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('‚ö° v2.3 - Response time acceptable', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(5000);",
                  "});",
                  "",
                  "pm.test('üìã v2.3 - Response has valid JSON structure', function () {",
                  "    pm.response.to.have.jsonBody();",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('data');",
                  "    pm.expect(json.data).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('‚úÖ v2.3 CRITICAL - market_data field should exist', function () {",
                  "    var firstItem = pm.response.json().data[0];",
                  "    pm.expect(pm.response).to.be.an('object');",
                  "    if (firstItem) {",
                  "        pm.expect(firstItem).to.have.property('market_data');",
                  "        // market_data can be null if no market data is available",
                  "    }",
                  "});",
                  "",
                  "pm.test('üìä v2.3 - market_data structure validation', function () {",
                  "    var body = pm.response.json();",
                  "    var firstItem = body.data[0];",
                  "    ",
                  "    if (firstItem && firstItem.market_data !== null && firstItem.market_data !== undefined) {",
                  "        pm.expect(firstItem.market_data).to.be.an('object');",
                  "        ",
                  "        // Validate market_data structure for stamps (consistent snake_case)",
                  "        const marketData = firstItem.market_data;",
                  "        pm.expect(marketData).to.have.property('floor_price_btc');",
                  "        pm.expect(marketData).to.have.property('volume_24h_btc');",
                  "        pm.expect(marketData).to.have.property('holder_count');",
                  "        pm.expect(marketData).to.have.property('data_quality_score');",
                  "        pm.expect(marketData).to.have.property('price_source');",
                  "    } else {",
                  "        // market_data can be null if no market data is available",
                  "        pm.test.skip('No market_data available for validation');",
                  "    }",
                  "});",
                  "",
                  "pm.test('üö´ v2.3 - No root-level market fields', function () {",
                  "    var firstItem = pm.response.json().data[0];",
                  "    if (firstItem) {",
                  "        pm.expect(firstItem).to.not.have.property('floorPrice', 'v2.3 should not have root floorPrice - moved to market_data.floor_price_btc');",
                  "        pm.expect(firstItem).to.not.have.property('floorPriceUSD', 'v2.3 should not have root floorPriceUSD - moved to market_data.floor_price_usd');",
                  "        pm.expect(firstItem).to.not.have.property('marketCapUSD', 'v2.3 should not have root marketCapUSD - calculated from market_data');",
                  "    }",
                  "});",
                  "",
                  "pm.test('‚úÖ v2.3 - Enhanced fields are present', function () {",
                  "    const json = pm.response.json();",
                  "    if (json.data && Array.isArray(json.data) && json.data.length > 0) {",
                  "        const firstItem = json.data[0];",
                  "        // stamp_url should be present in v2.3",
                  "        pm.expect(firstItem).to.have.property('stamp_url');",
                  "        // Note: dispenserInfo and cacheStatus may not be present on all stamps",
                  "    }",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-API-Version",
                "value": "2.3",
                "description": "Request v2.3 format (enhanced market data)"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v2/stamps?limit=5",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v2", "stamps"],
              "query": [
                {
                  "key": "limit",
                  "value": "5"
                }
              ]
            }
          }
        },
        {
          "name": "SRC20 Overview List - v2.3 (Enhanced MarketData)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ v2.3 - SRC20 Overview endpoint responds', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('‚ö° v2.3 - Response time acceptable', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(5000);",
                  "});",
                  "",
                  "pm.test('üìã v2.3 - Response has valid JSON structure', function () {",
                  "    pm.response.to.have.jsonBody();",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('data');",
                  "});",
                  "",
                  "pm.test('‚úÖ v2.3 CRITICAL - marketData field handling', function () {",
                  "    pm.expect(pm.response.json()).to.be.an('object');",
                  "    const responseData = pm.response.json();",
                  "    pm.expect(responseData).to.have.property('data');",
                  "    pm.expect(responseData.data).to.be.an('array').that.is.not.empty;",
                  "    ",
                  "    // Check first item - market_data only exists for DEPLOY operations",
                  "    const firstItem = responseData.data[0];",
                  "    if (firstItem.op === 'DEPLOY') {",
                  "        pm.expect(firstItem).to.have.property('market_data');",
                  "        pm.expect(firstItem.market_data).to.satisfy(function(val) { return val === null || typeof val === 'object'; });",
                  "    } else {",
                  "        // MINT and TRANSFER operations should NOT have market_data",
                  "        pm.expect(firstItem).to.not.have.property('market_data');",
                  "    }",
                  "    ",
                  "    // Store for cross-version comparison",
                  "    pm.globals.set('v23_src20_has_marketData', firstItem.market_data !== undefined);",
                  "});",
                  "",
                  "pm.test('üìä v2.3 - SRC20 market_data structure validation', function () {",
                  "    const firstItem = pm.response.json().data[0];",
                  "    const marketData = firstItem.market_data;",
                  "    ",
                  "    // Validate market_data structure for SRC20 (standardized snake_case)",
                  "    if (marketData && marketData !== null) {",
                  "        pm.expect(marketData).to.be.an('object');",
                  "        pm.expect(marketData).to.have.property('tick');",
                  "        ",
                  "        // ‚úÖ UPDATED: Standardized field names (consistent with stamps)",
                  "        pm.expect(marketData).to.have.any.keys('floor_price_btc', 'market_cap_btc', 'volume_24h_btc', 'holder_count');",
                  "        ",
                  "        // ‚úÖ NEW: Comprehensive volume timeframes validation",
                  "        if (marketData.volume_24h_btc !== undefined) {",
                  "            pm.expect(marketData).to.have.property('volume_7d_btc');",
                  "            pm.expect(marketData).to.have.property('volume_30d_btc');",
                  "            ",
                  "            // Validate volume values are numeric and non-negative",
                  "            pm.expect(marketData.volume_24h_btc).to.be.a('number');",
                  "            pm.expect(marketData.volume_7d_btc).to.be.a('number');",
                  "            pm.expect(marketData.volume_30d_btc).to.be.a('number');",
                  "            ",
                  "            pm.expect(marketData.volume_24h_btc).to.be.at.least(0);",
                  "            pm.expect(marketData.volume_7d_btc).to.be.at.least(0);",
                  "            pm.expect(marketData.volume_30d_btc).to.be.at.least(0);",
                  "        }",
                  "        ",
                  "        // Validate nested market_data_sources (consistent snake_case naming)",
                  "        if (marketData.market_data_sources) {",
                  "            pm.expect(marketData.market_data_sources).to.be.an('object');",
                  "            pm.expect(marketData.market_data_sources).to.have.any.keys('stampscan', 'openstamp');",
                  "        }",
                  "    } else {",
                  "        pm.test.skip('No market_data available for this SRC20 token');",
                  "    }",
                  "});",
                  "",
                  "pm.test('üìä v2.3 - Volume timeframes comprehensive validation', function () {",
                  "    const firstItem = pm.response.json().data[0];",
                  "    const marketData = firstItem.market_data;",
                  "    ",
                  "    if (marketData && marketData !== null) {",
                  "        // All volume timeframes must be present",
                  "        const requiredVolumeFields = ['volume_24h_btc', 'volume_7d_btc', 'volume_30d_btc'];",
                  "        requiredVolumeFields.forEach(field => {",
                  "            pm.expect(marketData, `Missing ${field} field`).to.have.property(field);",
                  "        });",
                  "        ",
                  "        // Logical volume relationships (7d >= 24h, 30d >= 7d in most cases)",
                  "        if (marketData.volume_24h_btc > 0 && marketData.volume_7d_btc > 0) {",
                  "            pm.expect(marketData.volume_7d_btc, 'Weekly volume should typically be >= daily volume').to.be.at.least(marketData.volume_24h_btc * 0.1);",
                  "        }",
                  "        ",
                  "        if (marketData.volume_7d_btc > 0 && marketData.volume_30d_btc > 0) {",
                  "            pm.expect(marketData.volume_30d_btc, 'Monthly volume should typically be >= weekly volume').to.be.at.least(marketData.volume_7d_btc * 0.1);",
                  "        }",
                  "    }",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-API-Version",
                "value": "2.3",
                "description": "Request v2.3 format (enhanced market data)"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v2/src20?limit=5",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v2", "src20"],
              "query": [
                {
                  "key": "limit",
                  "value": "5"
                }
              ]
            }
          }
        },
        {
          "name": "SRC20 MINT Operations - v2.3 (No Market Data Expected)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ v2.3 - MINT operation responds successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('üö´ CRITICAL - MINT operations should NOT have market_data', function () {",
                  "    const json = pm.response.json();",
                  "    if (json.data && Array.isArray(json.data) && json.data.length > 0) {",
                  "        json.data.forEach((item, index) => {",
                  "            pm.expect(item.op, `Item ${index} should be MINT operation`).to.equal('MINT');",
                  "            pm.expect(item, `MINT operation ${index} should not have market_data`).to.not.have.property('market_data');",
                  "        });",
                  "    }",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-API-Version",
                "value": "2.3",
                "description": "Request v2.3 format (should still exclude market_data for MINT)"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v2/src20?op=MINT&tick=STAMP&limit=3",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v2", "src20"],
              "query": [
                {
                  "key": "op",
                  "value": "MINT"
                },
                {
                  "key": "tick",
                  "value": "STAMP"
                },
                {
                  "key": "limit",
                  "value": "3"
                }
              ]
            }
          }
        },
        {
          "name": "SRC20 TRANSFER Operations - v2.3 (No Market Data Expected)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ v2.3 - TRANSFER operation responds successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('üö´ CRITICAL - TRANSFER operations should NOT have market_data', function () {",
                  "    const json = pm.response.json();",
                  "    if (json.data && Array.isArray(json.data) && json.data.length > 0) {",
                  "        json.data.forEach((item, index) => {",
                  "            pm.expect(item.op, `Item ${index} should be TRANSFER operation`).to.equal('TRANSFER');",
                  "            pm.expect(item, `TRANSFER operation ${index} should not have market_data`).to.not.have.property('market_data');",
                  "        });",
                  "    }",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-API-Version",
                "value": "2.3",
                "description": "Request v2.3 format (should still exclude market_data for TRANSFER)"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v2/src20?op=TRANSFER&tick=STAMP&limit=3",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v2", "src20"],
              "query": [
                {
                  "key": "op",
                  "value": "TRANSFER"
                },
                {
                  "key": "tick",
                  "value": "STAMP"
                },
                {
                  "key": "limit",
                  "value": "3"
                }
              ]
            }
          }
        },
        {
          "name": "SRC20 DEPLOY Operations - v2.3 (Market Data Required)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ v2.3 - DEPLOY operation responds successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('‚úÖ CRITICAL - DEPLOY operations MUST have market_data', function () {",
                  "    const json = pm.response.json();",
                  "    if (json.data && Array.isArray(json.data) && json.data.length > 0) {",
                  "        json.data.forEach((item, index) => {",
                  "            pm.expect(item.op, `Item ${index} should be DEPLOY operation`).to.equal('DEPLOY');",
                  "            pm.expect(item, `DEPLOY operation ${index} must have market_data`).to.have.property('market_data');",
                  "            pm.expect(item.market_data, `DEPLOY market_data ${index} should not be null`).to.not.be.null;",
                  "        });",
                  "    }",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-API-Version",
                "value": "2.3",
                "description": "Request v2.3 format (should include market_data for DEPLOY)"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v2/src20?op=DEPLOY&tick=STAMP&limit=3",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v2", "src20"],
              "query": [
                {
                  "key": "op",
                  "value": "DEPLOY"
                },
                {
                  "key": "tick",
                  "value": "STAMP"
                },
                {
                  "key": "limit",
                  "value": "3"
                }
              ]
            }
          }
        },
        {
          "name": "Collections List - v2.3 (Enhanced MarketData)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ v2.3 - Collections endpoint responds successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('‚ö° v2.3 - Response time acceptable', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(5000);",
                  "});",
                  "",
                  "pm.test('üìã v2.3 - Collections response structure validation', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('data');",
                  "    if (json.data && Array.isArray(json.data) && json.data.length > 0) {",
                  "        const firstCollection = json.data[0];",
                  "        pm.expect(firstCollection).to.have.property('collection_name');",
                  "        pm.expect(firstCollection).to.have.property('stamp_count');",
                  "        pm.expect(firstCollection).to.have.property('total_editions');",
                  "        ",
                  "        // Collections may have market_data if available",
                  "        if (firstCollection.market_data) {",
                  "            pm.expect(firstCollection.market_data).to.be.an('object');",
                  "            pm.expect(firstCollection.market_data).to.have.property('min_floor_price_btc');",
                  "            pm.expect(firstCollection.market_data).to.have.property('total_unique_holders');",
                  "        }",
                  "    }",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-API-Version",
                "value": "2.3",
                "description": "Request v2.3 format (enhanced market data)"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v2/collections?limit=5",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v2", "collections"],
              "query": [
                {
                  "key": "limit",
                  "value": "5"
                }
              ]
            }
          }
        },
        {
          "name": "Cursed Endpoint Deprecation - v2.3 vs v2.2",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// Test v2.3 deprecation",
                  "pm.test('‚úÖ v2.3 - Cursed endpoint returns deprecation notice', function () {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.details.deprecated).to.be.true;",
                  "    pm.expect(response.error).to.include('deprecated');",
                  "    pm.expect(response.details.alternative).to.equal('/api/v2/stamps?type=cursed');",
                  "});",
                  "",
                  "pm.test('üö´ v2.3 - Cursed endpoint returns 410 Gone status', function () {",
                  "    pm.response.to.have.status(410);",
                  "});",
                  "",
                  "pm.test('üìã v2.3 - Deprecation headers present', function () {",
                  "    pm.expect(pm.response.headers.get('Deprecation')).to.equal('true');",
                  "    pm.expect(pm.response.headers.get('Sunset')).to.exist;",
                  "    pm.expect(pm.response.headers.get('X-Alternative-Endpoint')).to.equal('/api/v2/stamps?type=cursed');",
                  "});",
                  "",
                  "pm.test('üîó v2.3 - Alternative endpoint information provided', function () {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.details.supportedAlternative).to.exist;",
                  "    pm.expect(response.details.supportedAlternative.endpoint).to.equal('/api/v2/stamps?type=cursed');",
                  "    pm.expect(response.details.supportedAlternative.example).to.include('limit=10');",
                  "});",
                  "",
                  "// Now test v2.2 compatibility",
                  "pm.sendRequest({",
                  "    url: pm.variables.get('baseUrl') + '/api/v2/cursed?limit=1',",
                  "    method: 'GET',",
                  "    header: {",
                  "        'X-API-Version': '2.2'",
                  "    }",
                  "}, function (err, response) {",
                  "    pm.test('‚úÖ v2.2 - Cursed endpoint still works', function () {",
                  "        pm.expect(response).to.have.property('code', 200);",
                  "        const body = response.json();",
                  "        pm.expect(body.data).to.be.an('array');",
                  "        pm.expect(body.deprecated).to.not.exist;",
                  "    });",
                  "    ",
                  "    pm.test('üìä v2.2 - Returns actual cursed stamp data', function () {",
                  "        const body = response.json();",
                  "        if (body.data && body.data.length > 0) {",
                  "            pm.expect(body.data[0]).to.have.property('stamp');",
                  "            // Note: Not all cursed stamps have negative numbers in newer implementations",
                  "            pm.expect(body.data[0]).to.have.property('tx_hash');",
                  "        }",
                  "    });",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "X-API-Version",
                "value": "2.3"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v2/cursed?limit=1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v2", "cursed"],
              "query": [
                {
                  "key": "limit",
                  "value": "1"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "üîç Cross-Version Comparison Tests",
      "item": [
        {
          "name": "Compare Same Endpoint Across Versions",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// This test validates the same endpoint returns consistent core data across versions",
                  "pm.test('üîÑ Cross-version consistency check', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const json = pm.response.json();",
                  "    ",
                  "    // Store response for comparison in collection variable",
                  "    const version = pm.request.headers.get('X-API-Version') || 'default';",
                  "    const storageKey = `comparison_${version}_response`;",
                  "    pm.collectionVariables.set(storageKey, JSON.stringify(json));",
                  "    ",
                  "    console.log(`üìã Stored ${version} response for cross-version comparison`);",
                  "});",
                  "",
                  "pm.test('üìä Schema validation summary', function () {",
                  "    const json = pm.response.json();",
                  "    const version = pm.request.headers.get('X-API-Version') || 'default';",
                  "    ",
                  "    if (json.data && Array.isArray(json.data) && json.data.length > 0) {",
                  "        const firstItem = json.data[0];",
                  "        const hasMarketData = firstItem.hasOwnProperty('market_data');",
                  "        const hasRootPriceFields = firstItem.hasOwnProperty('floorPrice');",
                  "        ",
                  "        console.log(`üìã Version ${version} Schema Summary:`);",
                  "        console.log(`   market_data field: ${hasMarketData}`);",
                  "        console.log(`   Root price fields: ${hasRootPriceFields}`);",
                  "        console.log(`   Enhanced fields: ${firstItem.hasOwnProperty('dispenserInfo')}`);",
                  "        ",
                  "        if (version === '2.2') {",
                  "            pm.expect(hasMarketData).to.be.false;",
                  "            pm.expect(hasRootPriceFields).to.be.false;",
                  "        } else if (version === '2.3') {",
                  "            pm.expect(hasMarketData).to.be.true;",
                  "            pm.expect(hasRootPriceFields).to.be.false;",
                  "        }",
                  "    }",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-API-Version",
                "value": "{{api_version_for_comparison}}",
                "description": "Dynamic version for comparison testing"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v2/stamps?limit=3",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v2", "stamps"],
              "query": [
                {
                  "key": "limit",
                  "value": "3"
                }
              ]
            }
          }
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "postman",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Final test results summary",
          "console.log('üéØ API Version Compatibility Testing Complete');",
          "console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');",
          "",
          "try {",
          "    const results = pm.collectionVariables.get('version_validation_results');",
          "    if (results) {",
          "        const testResults = JSON.parse(results);",
          "        const v22Tests = testResults.filter(r => r.version === '2.2');",
          "        const v23Tests = testResults.filter(r => r.version === '2.3');",
          "        ",
          "        console.log(`üìä Test Summary:`);",
          "        console.log(`   v2.2 Tests: ${v22Tests.length}`);",
          "        console.log(`   v2.3 Tests: ${v23Tests.length}`);",
          "        console.log(`   Total Endpoints Tested: ${testResults.length}`);",
          "        ",
          "        const v22WithMarketData = v22Tests.filter(r => r.hasMarketData).length;",
          "        const v23WithMarketData = v23Tests.filter(r => r.hasMarketData).length;",
          "        ",
          "        console.log(`üîç Schema Compliance:`);",
          "        console.log(`   v2.2 with market_data: ${v22WithMarketData} (should be 0)`);",
          "        console.log(`   v2.3 with market_data: ${v23WithMarketData} (should be ${v23Tests.length})`);",
          "        ",
          "        if (v22WithMarketData > 0) {",
          "            console.log('‚ö†Ô∏è  WARNING: v2.2 endpoints returning market_data field!');",
          "        }",
          "        if (v23WithMarketData < v23Tests.length) {",
          "            console.log('‚ö†Ô∏è  WARNING: Some v2.3 endpoints missing market_data field!');",
          "        }",
          "        if (v22WithMarketData === 0 && v23WithMarketData === v23Tests.length) {",
          "            console.log('‚úÖ All version-specific schema validations passed!');",
          "        }",
          "    }",
          "} catch (e) {",
          "    console.log('Error generating summary:', e);",
          "}",
          "",
          "console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');",
          "console.log('üöÄ Ready for production deployment!');"
        ]
      }
    }
  ]
}
